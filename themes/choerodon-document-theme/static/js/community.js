var communitySite="http://forum.choerodon.io",listLength=7;function getData(t){$("#forum").append("<div class='all-load'></div>");var c=$("<table>"),e=$("<tr style='border-bottom: 2px solid #ddd;'>");e.append("<td class='td1'>用户</td>"),e.append("<td class='td2'>主题</td>"),e.append("<td class='td3'>回复</td>"),e.append("<td class='td4'>浏览</td>"),e.append("<td class='td5'>活动</td>"),c.append(e),$.getJSON(communitySite+"/"+t+".json",function(t){if(t){$("table").remove(),$("div#error").remove();var e,a=t.users,o=t.topic_list.topics;listLength=o.length<7?o.length:7;for(var s=0;s<listLength;s++){for(var d=o[s].posters[0].user_id,n=0;n<a.length;n++)a[n].id===d&&(e="http://forum.choerodon.io/"+a[n].avatar_template.replace("{size}","32"));var r=new Date(o[s].bumped_at).getTime(),i=((new Date).getTime()-r)/36e5;i=24<=i?i/24<=7?Math.round(i/24)+"天前":new Date(o[s].bumped_at).Format("M月d日"):i<1?Math.round(60*i)+"分钟前":Math.round(i)+"小时前";var l=$("<tr onclick=window.open('"+communitySite+"/t/"+o[s].slug+"/"+o[s].id+"','_self') style='cursor: pointer;'>");c.append(l);var p=Number(o[s].posts_count)-1;l.append("<td class='td1'><img src='"+e+"'></td>"),l.append("<td class='td2'>"+o[s].title+"</td>"),l.append("<td class='td3'>"+p+" </td>"),l.append("<td class='td4'>"+o[s].views+"</td>"),l.append("<td class='td5'>"+i+"</td>")}$("div.all-load").remove(),$("#forum").append(c)}}).fail(function(){$("table").remove(),$("div#error").remove();var t=$("<div id='error' style='margin-top:40px;'>");t.append("<h3 style='font-size:24px;color:#000;letter-spacing:0;line-height:40px;'>很抱歉！</h3><p style='font-size: 16px; color: #4f5d6c; letter-spacing: 0;'>社区暂时走丢，我们正在全力抢救</p>"),$("div.all-load").remove(),$(".community-content").append(t)})}Date.prototype.Format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var a in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},$(document).ready(function(){getData("latest")}),$("#latest-btn,#hotest-btn").click(function(){$("table").remove(),$("div#error").remove(),$(this).addClass("choose").siblings().removeClass("choose")}),$("#latest-btn").click(function(){getData("latest")}),$("#hotest-btn").click(function(){getData("top")});