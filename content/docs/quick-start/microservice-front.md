+++
title = "创建一个前端应用"
description = ""
weight = 3
+++

# 创建一个前端应用
---

## 概述

就前端主流技术框架的开发而言，过去几年里发展极快，在填补原有技术框架空白和不足的同时也渐渐趋于成熟。未来前端在已经趋向成熟的技术方向上面会慢慢稳定下来，并进入技术迭代优化阶段，但这并不代表前端领域技术就此稳定了，因为新的技术方向已经出现，并在等待下一个风口的到来。可能是虚拟现实也有可能是人工智能或者其他。

Choerodon 使用 `React` 作为前端应用框架，并且对前端的展示做了一定的封装和处理，能够让用户方便快捷地进行前端应用的开发和部署。`React`和`MobX`是一对强力组合，`React`通过提供机制把应用状态转换为可渲染组件树并对其进行渲染。而`MobX`提供机制来存储和更新应用状态供`React`使用。 这种机制就是通过使用虚拟`DOM`来减少昂贵的`DOM`变化的数量。`MobX` 提供了优化应用状态与 `React` 组件同步的机制，这种机制就是使用响应式虚拟依赖状态图表，它只有在真正需要的时候才更新并且永远保持是最新的。

## 目标

本章节将从创建前端应用、开发前端应用、部署应用、配置网络、配置域名等方面介绍，让读者能够熟悉使用Choerodon创建前端应用的步骤和流程，并且学会如何利用Choerodon创建并部署前端应用。

## 前置条件

**1.** 在操作之前保证[系统配置](../../user-guide/system-configuration)已经配置完全。特别在本章节用到的角色、环境管理等配置。

**2.** 完成[创建项目](../project)操作。本章节使用在前面章节创建的项目`猪齿鱼研发`。

**3.** 完成[创建环境](../../user-guide/deployment-pipeline/environment-pipeline)，环境流水线中有状态为运行中的环境。

## 创建前端应用

**1.** 使用项目所有者或者源代码管理员的角色登录Choerodon系统，选择项目``猪齿鱼研发``。

**2.** 选择`持续交付`模块，点击`开发流水线`，点击`应用`，进入应用管理页面。

**3.** 点击``创建应用``，系统会从右边滑出页面，在页面中输入相关信息，有应用编码、应用名称，选择应用模板。

**1.** 使用项目所有者或者源代码管理员的角色登录Choerodon系统，选择项目``猪齿鱼研发``。

**2.** 选择`持续交付`模块，点击`开发流水线`，点击`应用`，进入应用管理页面。

**3.** 点击`创建应用`，系统会从右边滑出页面，在页面中输入`应用编码`、`应用名称`，`应用模板`，`应用模板`选择`MicroServiceUI`。点击`创建`，即可创建一个前端应用。

字段名 | 输入值
---|--- 
应用编码 | `choerodon-front-demo`
应用名称 | `猪齿鱼前端Demo应用`
选择应用模板 | `MicroServiceUI`

> 当应用模板不符合您的需求，您可手动创建一个[应用模板](../../user-guide/development-pipeline/application-template/)。 
   
**4.** 当应用创建成功，可在`开发流水线` -> `应用` 界面查看到新建的应用。

**5.** 在创建应用的同时，系统会对应在`Gitlab`中创建一个仓库，点击 `仓库地址`，链接到`Gitlab`新建的仓库。

Choerodon 名词 | 对应Gitlab 名词 | 举例
---|---|---
项目名 | 组名 | `猪齿鱼研发`
应用编码 | 项目名 |`choerodon-front-demo`
应用名称 | 无 |`猪齿鱼前端Demo应用`

## 开发前端应用

应用创建完成之后，开发前端应用。具体的操作步骤如下：

**1. 创建`Feature`分支**

在 `开发流水线` -> `应用` 界面中找到`choerodon-front-demo`。选择分支管理，点击`创建分支`，选择`创建feature分支`，填写`issue`号，如`feature-1`。点击`创建`，即可创建一个分支。

Choerodon 采用 `git-flow` 工作流模式，有`master`和`develop`两个默认分支。在持续交付过程中对 `feature`、`release`、`hotfix` 等分支进行管理。结束分支可自动触发分支合并和持续集成，可在流水线查看代码集成情况。更多相关信息参考[分支管理](../../user-guide/development-pipeline/branch-management/)。


**2. 拉取代码仓库**

在`开发流水线` -> `应用` 找到`choerodon-front-demo` 的`仓库地址`。通过git命令拉取生成的项目代码。然后切换到对应分支进行本地开发。

``` bash
$ git clone `仓库地址`
$ cd ./choerodon-front-demo
$ git checkout feature-1
```

**3. 本地开发**

将代码克隆到本地后，就可以在本地进行开发。

通过Choerodon 提供的`MicroService` 应用模板，会生成一个最简单的`spring boot` 应用。

模板本身生成的应用可以直接运行在平台上。更多具体的开发参考[前端开发手册](../../development-guide/front/)。


**4. 修改`ci` 文件**

通过Choerodon 提供的默认模板，会创建`.gitlab-ci.yml`。

`.gitlab-ci.yml`定义 `Gitlab CI` 的阶段，Choerodon 缺省的 CI 流程包含了`编译`，`打包`，`生成镜像`，`生成helm 包`几个阶段。	

有关`.gitlab-ci.yml` 的编写参考[应用模板](../../user-guide/development-pipeline/application-template/)。

**5. 修改`charts` 文件**

通过Choerodon 提供的默认模板，会创建`charts` 文件夹。

`charts`模块用于创建应用时生成创建 `k8s` 对象，包含了`部署的模板`，`chart values`。

有关`charts` 的编写参考[应用模板](../../user-guide/development-pipeline/application-template/)。

**6. 修改`Dockerfile` 文件**

Choerodon 使用`docker` 来运行应用。你可以通过修改`Dockerfile` 来修改应用的运行环境。

有关`Dockerfile` 的编写参考[应用模板](../../user-guide/development-pipeline/application-template/)。

**7. 提交代码**

当本地修改结束后，需要将本地仓库的代码提交到远程分支上。

``` bash
$ git add .
$ git commit -m "[ADD] init choerodon-front-todo"
$ git push origin feature-1
```

提交时需要遵循Choerodon 的规范:

* [IMP] 提升改善正在开发或者已经实现的功能
* [FIX] 修正BUG
* [REF] 重构一个功能，对功能重写
* [ADD] 添加实现新功能
* [REM] 删除不需要的文件

**9. 代码集成**

当代码提交到服务器之后，可以在页面查看持续集成。

在`开发流水线` -> `持续集成` 页面，找到`choerodon-front-demo`。点击阶段跳转到`Gitlab` 查看`ci`执行情况。

**10. 结束分支**　

当`ci`执行通过以后，可以关闭分支，将`feature`分支合并到`develop`分支上。

在`开发流水线` -> `应用` 页面，找到`choerodon-front-demo`。选择分支管理，找到`feature-1` 分支，点击`结束分支`。结束分支后，会触发`develop` 分支的`ci流水线`。

当`develop` 分支的`ci流水线` 通过以后。在`开发流水线` -> `应用版本` 可以找到，`choerodon-front-demo`生成的对应版本。接下来就可以部署了。

## 部署应用

提供可视化、一键式部署应用，支持并行部署和流水线无缝集成，实现部署环境标准化和部署过程自动化。

**1.** 使用部署管理员的角色登录Choerodon系统，选择项目`猪齿鱼研发`。

**2.** 进入`持续交付`模块，选择`部署流水线` -> `应用部署` 进入应用部署界面。

**3.** 点击`选择应用`，找到已经提交的`choerodon-front-demo`。点击`选择版本`，选择`choerodon-front-demo` 最新的版本，点击下一步。

**4.** 点击`选择环境`，选择一个环境。部署的环境信息会展现在底下。如果没有环境，请先完成[创建环境](../../user-guide/deployment-pipeline/environment-pipeline)。

**5.** 根据实际的配置，配置部署应用所需的配置信息。然后点击下一步。

**6.** 选择`新建实例`。如果环境中已有一个实例，则可以选择`替换实例`。点击下一步，生成预览信息。

**7.** 确认信息无误后，可以点击`部署` 来部署应用，页面自动跳转到`实例`页面。

**8.** 选择已经部署的应用，右侧的`查看实例详情`，可以查看到阶段信息及日志。

> **如何判断某版本的应用已经部署成功并通过？**
>
>* 当实例出现在列表中，且实例名称后没有报错提示`icon`即为部署成功生成实例；
>* 当容器状态条为绿色，且容器状态显示为`1/1`时，表示新部署的实例通过健康检查。

## 配置网络

前端应用部署成功以后，需要创建对应的网络，才能够被外部访问。

**1.** 使用部署管理员的角色登录Choerodon系统，选择项目``猪齿鱼研发``。

**2.** 进入`持续交付`模块，选择`部署流水线` -> `网络`。

**3.** 点击`创建网络`，输入如下信息：

字段名 | 含义
|---|---|
环境名称 | 选择要部署的环境。如果没有环境，请先完成[创建环境](../../user-guide/deployment-pipeline/environment-pipeline)
应用名称 | 猪齿鱼前端Todo应用
版本 | 正在运行的应用版本
实例 | 部署的实例id
网络名称 | 名称默认为`应用编码-4位随机码`，且可手动修改
外部IP | k8s集群节点ip，默认随机分配节点
端口号 | 网络开放的端口号
目标端口号 | 网络选择的目标实例所暴露的端口号

**4.** 点击`创建` 按钮，网络创建成功。

## 配置域名
  
创建对应的网络后，同时需要给网络指定外网域名，这样外部可以直接通过域名访问到前端。

**1.** 使用部署管理员的角色登录Choerodon系统，选择项目`猪齿鱼研发`。

**2.** 进入`持续交付`模块，选择`部署流水线` -> `域名`。

**3.** 点击`创建域名`，输入如下信息：

字段名 | 含义
|---|---|
域名 | 测试域名
域名地址 | choerodon.io（请填写所属环境集群主机绑定的域名及其子域名地址）
路径 | 默认为根目录`/`，遵循`Ant path`的规范
网络 | 选择上一步创建的网络

**4.** 点击`创建` 按钮，域名创建成功。

## 总结

通过上述的步骤，就可以很快速的在Choerodon 中创建并部署一个后端的服务。